<!DOCTYPE html>
<html class="no-js">
<%- include("../../panel/layouts/head.ejs",{
title:"TeklaFilm::ControlPanel" ,
des:"TeklaFilm::ControlPanel" ,
}) %>

<body class="nav-md">
<div class="container body">
    <div class="main_container">

        <%- include ../../panel/layouts/menu.ejs  %>
        <!-- top navigation -->
        <%- include ../../panel/layouts/topNav.ejs  %>
        <!-- /top navigation -->
        <!-- /header content -->

        <!-- page content -->
        <div id="panelContent" class="right_col" role="main">

            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="preloader loading">
                            <span class="slice"></span>
                            <span class="slice"></span>
                            <span class="slice"></span>
                            <span class="slice"></span>
                            <span class="slice"></span>
                            <span class="slice"></span>
                        </div>
                        <div class="page-loader-wrapper3">
                        </div>
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Create new <%-type%> article

                                </h2>

                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">

                                <form class="form-horizontal form-label-left">
                                    <div class="row">
                                        <div class="col-md-6 form-group">
                                            <label>title<span class="required">*</span></label>
                                            <input type="text" name="title" id="title"  class="form-control persian" >
                                        </div>



                                    </div>
                                    <div class="row">
                                        <div class="col-md-12 form-group">
                                            <label>description<span class="required">*</span></label>
                                            <textarea id="text" rows="15"  class="form-control"></textarea>


                                        </div>



                                    </div>
                                    <div class="row">


                                        <div class="col-md-4 form-group">

                                            <label   style="padding:2px">&nbsp;thumb</label>



                                            <label for="image" class="inputfile-6"><span></span> <strong><i class="fa fa-cloud-upload" ></i> choose image</strong></label>
                                            <input type="file" name="image"  onchange="uploadFile('image','4')" id="image" accept=".jpeg,.jpg,.png" class="inputfile" data-multiple-caption="{count} files selected" multiple />

                                        </div>


                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 form-group">


                                <span id="tagimage">
<input id="imagePath" value="" type="hidden" class="form-control">
</span>




                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-2  form-group">
                                            <label >&nbsp;</label>

                                            <button data-pid="q" type="button" id="sendNews" class="form-control btn btn-success">ارسال</button>

                                        </div>
                                    </div>
                                    <div class="ln_solid"></div>
                                    <div class="row"  align="center" id="alertmsg" style="color: red; height: 40px" ></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <%- include ../../panel/layouts/footer.ejs %>
    </div>
</div>

<div class="modal modal-danger fade" id="modal-delete">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body" >
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info pull-right" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning pull-left" data-id="q" id="delete_item" onclick="deleteItem()" data-dismiss="modal">Delete</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<%- include ../../panel/layouts/scripts.ejs %>
<script src="<%-host%>/admin/vendors/tinymce/tinymce.min.js"></script>
<div id="reload" style="display:none;"></div>
<div id="uploading" class="uploading"></div>
<div class="uploadLoadingImg">
    Please wait until uploading the file

</div>
<div id="loading" style="display: none; position: fixed; top: 80px; left: 38%; width:19%; height: 40px; background: #fff0ff; padding: 6px; text-align: center">
    <h4 class="modal-title">Receiving information</h4>
</div>
<script>
    function uploadFile(inputId,mimeType) {
        var file  = $('#'+inputId).prop('files')[0];
        if (file){
            var form_data = new FormData();
            form_data.append('inputId', inputId);
            form_data.append('file', file);
            form_data.append('mimeType', mimeType);

            $('.uploading').fadeIn(100);
            $('.uploadLoadingImg').fadeIn(100);
            $.ajax({
                url: '/uploading',
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                method: 'POST',
                type: 'POST',
                success :function(data){
                    $('.uploading').fadeOut(100);
                    $('.uploadLoadingImg').fadeOut(100);
                    $('#tag'+inputId).html(data);


                    //$('#bg').fadeOut(100);

                }});
        }

    }
    function deleteUploadedFile(userfile,inputId) {

        $.post('/deleteUploaded', {
                fileName        : userfile,
                inputId         : inputId,
            },
            function(data){

                $('#tag'+inputId).html(data);
                $('#'+inputId).html('');
            });

    }
    $(function () {
        //Initialize Select2 Elements
        setTimeout(function () { $('.page-loader-wrapper3').fadeOut(); }, 50);
        setTimeout(function () { $('.preloader').fadeOut(); }, 50);


    })
    $('#sendNews').click(function () {
        $('#sendNews').prop('disabled', true);
        text  = tinyMCE.editors[$('#text').attr('id')].getContent();
        title = $('#title').val();
        description  = $('#description').val();
        summary  = $('#summary').val();
        source   = $('#source').val();
        source_link  = $('#source_link').val();
        image  = $('#imagePath').val();
        if (   text == ''   || title == '' ||  summary == '' ||  source == '' ||  source_link == ''  ){

            $('#alertmsg').html('لطفا همه فیلد ها را پر کنید');
            $('#sendNews').prop('disabled', false);
            return false;
        }
        else {
            $.ajax({
                url: 'create',
                data: {
                    text       : text,
                    title      : title,
                    summary    : summary,
                    source     : source,
                    image      : image,
                    source_link: source_link,

                },
                method: 'POST',
                success :function(data){

                    if(data.status == true){
                        $('#loading').fadeOut(100);
                        new PNotify({
                            title: 'عملیات موفق',
                            text: 'خبر، با موفقیت ایجاد شد' +
                                '<br>' +
                                'شما به صفحه لیست هدایت خواهید شد',
                            type: 'success',
                            styling: 'bootstrap3'
                        });
                        setTimeout(function () {
                            window.location = "list";
                        }, 1000);
                        $('html, body').animate({ scrollTop: 0 }, 'slow');




                    }


                }});
        }
    });


    tinymce.init({ selector:'#text',
        language: 'fa_IR',
        theme: 'modern',
        plugins: [
            'advlist autolink lists link image charmap print preview hr anchor pagebreak',
            'searchreplace wordcount visualblocks visualchars code fullscreen',
            'insertdatetime media nonbreaking save table contextmenu directionality',
            'emoticons template paste textcolor colorpicker textpattern imagetools codesample toc'
        ],
        toolbar1: 'undo redo | insert | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media | forecolor backcolor emoticons | codesample',
        image_advtab: true,
        templates: [
            { title: 'Test template 1', content: 'Test 1' },
            { title: 'Test template 2', content: 'Test 2' }
        ],
        content_css: [
            '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
            '//www.tinymce.com/css/codepen.min.css',
            'admin/build/css/tiny.css'
        ],
        images_upload_url: '/upload',
        relative_urls : false,
        remove_script_host : false,
        document_base_url : "https://ehghagh.com/"
    });

</script>
</body>
</html>